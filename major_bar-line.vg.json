{
    "$schema": "https://vega.github.io/schema/vega-lite/v5.json",

    "data" : {
        "url" : "data/Inj ALL 80-25.csv"
    },

    "vconcat" : [
        {
        "encoding" : {
            "x" : { 
                "field" : "Year", "type" : "quantitative",
                "axis" : {"format" : ".0f" },
                "scale" : {"domain" : [1975,2025]}  
            },
                
            "y" : { 
                "field" : "Number of injuries", "type" : "quantitative"}
        },

        "layer" : [
            {
                "title" : "Over time (drag to select a period)",
                "width" : 300,

                "mark" : "circle",

                "params" : [
                {
                    "name" : "brushYear",
                    "select" : {
                        "type" : "interval",
                        "encodings" : ["x"]
                    }
                }
                ],
                "encoding" : {
                    "color" : {
                        "field" : "TYPE2", "type" : "nominal", 
                        "title" : "Storm type"
                    },
                    
                    "tooltip" : [
                        {"field" : "TYPE2", "type" : "nominal", "title" : "Storm type"},
                        {"field" : "Year", "type" : "ordinal"},
                        {"field" : "State", "type" : "nominal"},

                        {"field" : "Number of injuries", "type" : "quantitative"},
                        {"field" : "Number of deaths", "type" : "quantitative"},

                        {"field" : "Feature", "type" : "nominal"},
                        {"field" : "Measure", "type" : "quantitative"}
                    ],
                    
                    "size" : {
                        "value" : 40
                    }
                }
            },
            {
                "transform" : [
                    {
                        "filter" : {"field" : "Year", "equal": 1995}
                    },
                    {
                        "filter" : {"field" : "TYPE2", "equal": "wind"}
                    },
                    {
                        "filter" : {"field" : "Latitude", "equal": -34.93}
                    }
                ],

                "mark" : {
                    "type" : "text",
                    "text" : [
                        "In 1995 there were 9 wind",
                        "storms, causing 79 injuries",
                        "- largely in South Australia."],
                    "dx" : 10, "dy" : -10,
                    "align" : "left"
                }
            },
            {
                "transform" : [
                    {
                        "filter" : {"field" : "Year", "equal": 2005}
                    },
                    {
                        "filter" : {"field" : "TYPE2", "equal": "hail"}
                    }
                ],

                "mark" : {
                    "type" : "text",
                    "text" : [
                        "In 2005 a hail storm in the Northen",
                        "Territory caused the most injuries",
                        "of any one storm since 1980."],
                        "dx" : 10,
                        "align" : "left"
                    }
            }     
        ]
        },
        {
        "layer" : [
            {
                "title" : "Between states",
                "width" : 300,

                "transform" : [
                    {
                        "filter" : {"param" : "brushYear"} 
                    },
                    {
                        "lookup" : "State",
                        "from" : {
                            "data" : {"url" : "data/Population est 25.csv"},
                            "key" : "Abbrev",
                            "fields" : ["Population"]
                        }
                    },
                    {
                        "calculate" : "10*datum['Number of injuries'] / datum.Population",
                        "as" : "injPerPop"
                    }
                ],
                "mark" : "bar",

                "encoding" : {
                    "x" : { 
                        "field" : "State", "type" : "nominal",
                        "sort" : {"field" : "injPerPop", "order" : "descending"}
                    },
                    "y" : {
                        "field" : "injPerPop", "type" : "quantitative",
                        "title" : "Injuries per 10,000 people"
                    },
                    
                    "color" : {
                        "field" : "TYPE2", "type" : "nominal", "title" : "Storm type"
                    },

                    "tooltip" : [
                        {"field" : "TYPE2", "type" : "nominal", "title" : "Storm type"},
                        {"field" : "Year", "type" : "ordinal"},
                        {"field" : "State", "type" : "nominal"},

                        {"field" : "Number of injuries", "type" : "quantitative"},
                        {"field" : "Number of deaths", "type" : "quantitative"},

                        {"field" : "Feature", "type" : "nominal"},
                        {"field" : "Measure", "type" : "quantitative"}
                    ]
                }               
            },
          {
                "mark" : {
                    "type" : "text",
                    "text" : [
                        "Injuries are normalised",
                        "by state population."],
                    "dx" : -10, "dy" : -10,
                    "x" : "width"
                },
                "data" : {
                    "values" : [{}]
                }
            }   
        ]
    }
    ]

}